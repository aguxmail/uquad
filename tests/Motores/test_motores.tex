\documentclass[spanish,12pt,a4paper,titlepage]{report}
\usepackage[latin1]{inputenc}
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{float}
\usepackage{wrapfig}
\usepackage{multirow}
\usepackage{caption}
\usepackage[spanish]{babel}
\usepackage[dvips]{hyperref}
\usepackage{amssymb}
\usepackage{listings}
\usepackage{epsfig}
\usepackage{amsmath}
\usepackage{array}
\usepackage[table]{xcolor}
\usepackage{multirow}
%\usepackage[Sonny]{fncychap}
\usepackage[Lenny]{fncychap}
%\usepackage[Glenn]{fncychap}
%\usepackage[Conny]{fncychap}
%\usepackage[Rejne]{fncychap}
%\usepackage[Bjarne]{fncychap}
%\usepackage[Bjornstrup]{fncychap}

%\usepackage{subfiles}
%\usepackage{framed}

\setlength{\topmargin}{-1.5cm}
\setlength{\textheight}{25cm}
\setlength{\oddsidemargin}{0.3cm} 
\setlength{\textwidth}{15cm}
\setlength{\columnsep}{0cm}


\begin{document}

\chapter{Caracterización de los motores}
\section{Objetivo}
El objetivo de este Test es el de caracterizar el funcionamiento de los motores. Con dicho fin se busca determinar:

\begin{itemize}
\item Relación entre velocidad angular y fuerza
\item Relación entre comando I2C y la velocidad angular.
\item Relación entre comando I2C y la fuerza.
\item Relación entre velocidad angular y torque.
\item Relación entre comando I2C y torque.
\item Respuesta al escalón
\end{itemize}

Los algoritmos de control se centraran o bien en la velocidad angular o bien en los comandos I2C. Por dicho motivo es fundamental como se relacionan dichas magnitudes con la fuerza y el torque. Asimismo, si se decidiera que el control estuviera centrado en la velocidad angular se debe conocer la relación entre esta última y el comando I2C ya que es sobre los comandos I2C que se tiene real poder de actuar.

\section{Materiales}
\begin{itemize}
\item Motores del cuadricóptero Turbo Ace X720	
\item LED IR TSAL6200
\item Detector IR TSOP38256
\item Balanza 
\item Beagleboard XM rev C
\item Osciloscopio digital
\item Generador de onda
\item Analizador lógico ChronoVu
\end{itemize}

%TODO canetti 13 feb
% agregar modelo de la balanza, apreciación, caracterización del error, etc
%Agregar modelo del osciloscopio y generador de onda
% tiene que poderse reproducir!
% agregar croquis del plan
% ref rota en la sección obtención de la la curva

\section{Procedimiento}


\subsection{Consideraciones previas}
\subsubsection*{Funcionamiento del dispositivo IR}
Es necesario entender el funcionamiento del \emph{detector IR} para poder realizar un experimento adecuado. Dicho dispositivo es sensible a las \emph{radiaciones infrarrojas}. Si se lo expone a una luz infrarroja constante la salida del dispositivo es un ``1" lógico. Del mismo modo, si se quita dicha fuente de luz la salida continúa siendo un ``1''. \\

En la hoja de datos del dispositivo se explica que mientras se recibe una onda cuadrada de frecuencia 56kHz la salida del mismo es un ``0". Por lo tanto para poder distinguir cuando llega la radiación emitida por la LED de cuando no llega se debe hacer que esta última conmute entre ON y OFF con una frecuencia de 56kHz. Dicho de otro modo, el detector IR debe recibir la información modulada en una frecuencia de 56kHz para luego decodificarla.

\subsubsection*{Diseño del circuito de medida de velocidad angular}

La idea del dispositivo de medida es sencilla. Se trata de hacer ``pasar" la radiación infrarroja emitida por el LED a través de la hélice en funcionamiento de uno de los motores. Esta radiación es recogida del otro lado por el receptor IR.\\

De este modo tendremos a la salida del detector, pulsos de frecuencia correspondientes a la velocidad con la que la hélice obstruye el camino entre el sensor y la LED. \textbf{La velocidad angular será entonces la mitad de dicha frecuencia}.\\ 

\begin{wrapfigure}{l}{0.55\textwidth}
  \vspace{-20pt}
  \begin{center}
    \includegraphics[width=0.42\textwidth]{./Pics/u.jpg}
  \end{center}
  \vspace{-20pt}
  \caption{Dispositivo en forma de U}
  \label{fig:u}
  \vspace{-10pt}
\end{wrapfigure}

El dispositivo se trata de un cuerpo en forma de ``U", donde de un lado se tiene la LED infrarroja y del otro el detector, tal como se puede ver en la figura \ref{fig:u}.\\

Como explicamos anteriormente la LED debe ser conmutada con una frecuencia de 56kHz por lo tanto se la alimentará con un generador de señales funcionando como generador de onda cuadrada a dicha frecuencia. Para lograr un correcto funcionamiento de la misma se requiere una corriente superior a los $100mA$. La amplitud de la onda cuadrada se regulará a $5V$ y se trabajará con una resistencia de $20\Omega$ en serie. Midiendo la tensión en la resistencia se puede comprobar que dichos valores son adecuados para el propósito.\\

La salida del receptor IR se conecta directamente a un frecuencímetro.\\

\subsection{Relación entre comando I2C, velocidad angular y empuje}

\subsubsection*{Obetivos particulares}
Este experimento serivrá para obtener las curvas:
\begin{itemize}
\item Relación entre velocidad angular y fuerza
\item Relación entre comando I2C y la velocidad angular.
\item Relación entre comando I2C y la fuerza.
\end{itemize}

\subsubsection*{Modelos de ajuste}

Es claro que si no se envía ningún comando i2c los motores no giran. También es evidente que si los motores no giran las hélices no realizan ningún empuje. Por lo tanto los modelos deben estar ajustados al cero. 
\begin{itemize}


\item Para la relación entre velocidad angular y fuerza en base a la bibliografía consultada sobre el tema se proponen dos modelos de ajuste siguientes:

	\begin{itemize}
	\item Modelo cuadrático $T=a\omega^2+b\omega$
	\item Modelo cúbico $T=a\prime \omega^3+b\prime \omega^2+c\prime$
	\end{itemize}

\item Para la relación entre comando I2C y la velocidad angular se propone un ajuste en base a los siguientes modelos:
	\begin{itemize}
	\item Modelo cuadrático $\omega=ax^2+bx$
	\item Modelo cúbico $\omega =a\prime x^3+b\prime x^2+cx$	
	\item Modelo de Monod $\omega = \frac{a\prime\prime x}{b\prime \prime x+c\prime\prime}$
	\end{itemize}

\item Para la relación entre comando I2C  y fuerza se propone un ajuste en base a los modelos: %TODO

\end{itemize}

\subsubsection*{Desarrollo del experimento}
El procedimiento consiste en enviar distintos comandos I2C al cuadricóptero y registrar las diferentes lecturas de masa en la balanza para determinar el empuje de los motores y en registrar las diferentes medidas de frecuencia en el osciloscopio para determinar la velocidad angular de los cuatro motores.
El setup experimental puede observarse en la figura \ref{fig:setup1}
Se solidariza el cuadricóptero a una base de madera. Sobre esta última se añade peso suficiente para asegurar que el cuadricóptero no se eleve, se agregaron 3Kg de sobrepeso para asegurar completamente dicha condición. Al estar el sistema en equilibrio mecánico se cumple que:
%TODO agregar croquis
$$
\sum F_{ext}=0
$$
En este caso las fuerzas presentes son el peso del sistema ($M_total$) la normal de la balanza sobre el sistema($N$) y el empuje de los motores($T_total$). Por lo tanto

$$
T_{total}-M_{total}g+N=0
$$
Por lo tanto el empuje de los motores puede calcularse como:
$$
T_{total}=M_{total}g-N
$$

La lectura de la balanza no es otra cosa que $\frac{N}{g}$.
Una vez ubicado el cuadricóptero con el sobrepeso sobre la balanza se tara la balanza. Por lo tanto la lectura que indica la balanza($M_{medida}$) luego de realizada esta acción es:
$$
M_{medida}=\frac{N-M_{total}g}{g}
$$

Por lo tanto el empuje de los cuatro motores puede calcularse como:

$$
T_{total}=-M_{medida}g
$$
Asumiendo que los cuatro motores se comportan en forma similar se tiene que:

$$
T=-\frac{M_{medida}g}{4}
$$

La medida de frecuencia se realiza con el dispositivo IR descrito en la sección anterior. La frecuencia medida ($f_{medida}$) corresponde al inverso del tiempo que transcurre entre el pasaje de una hoja de la hélice y la otra. El período de la rotación de la hélice es el doble y por ende la frecuencia de la rotación es la mitad de la frecuencia medida. Por lo tanto se tiene que:
$$
\omega=2\pi f=\pi f_{medida}
$$

Se mide la velocidad angular de los cuatro motores y se trabaja con el promedio. En la sección \ref{sec:motores} se verá porqué es adecuado considerar el promedio.

\subsection{Relación entre velocidad I2C, velocidad angular y torque}

\subsection{Respuesta al Escalón}
\section{Resultados y análisis}

\subsection{Obtención de la curva fuerza contra velocidad angular}

Los resultados obtenidos de frecuencia y medida en la balanza se presentan la tabla \ref{tab:fuerza-vel}.


En la figura \ref{fig:fvel} se observan los puntos obtenidos experimentalmente ya las curvas obtenidas con los modelos de ajuste propuesto. En dicha figura se observa que cualqueira de los dos modelos aproxima adecuadamente los puntos obtenidos experimentalmente.


Para el modelo cuadrático se obtiene:
\begin{itemize}
\item Parámetros: $a=3.5296\times10^{-5}Ns^2$, $b=-4.9293\times 10^{-4}Ns$
\item Error promedio: $e=-2.76\times 10 ^{-3}N$
\item Desviación estándar :$\sigma=4.03\times10^{-2}N$
\end{itemize}

Para el modelo cúbico se obtiene:
\begin{itemize}
\item Parámetros: $a\prime = -1.5197\times 10^{-8}Ns^3$, $b\prime =4.4399\times10^{-5}Ns^2$, $c\prime -0.0018Ns$
\item Error: $7.17\times10^{-4}N$
\item Desviación estándar: $\sigma=2.66\times 10^{-2}N$
\end{itemize}

\begin{table}[H]
\centering
\begin{tabular}{|p{80pt}|p{80pt}||p{80pt}|p{80pt}|} 
 \cellcolor[gray]{0.8} \textbf{Peso (g)} & \cellcolor[gray]{0.8} \textbf{Frecuencia (Hz)} & \cellcolor[gray]{0.8} \textbf{Peso (g)} & \cellcolor[gray]{0.8} \textbf{Frecuencia (Hz)}\\ \hline
 
 0  & 0     & -1010 & 86.13\\ \hline

-140 & 34.58   &  -1250  & 95.83  \\ \hline

 -300  & 49.03   & -1520 & 105.15\\ \hline

-500 & 63.30 & -1870  & 116.53 \\ \hline

-765  & 75.00  & -2400 & 132.9\\ \hline


\end{tabular}
\caption{Medidas obtenidas de peso y frecuencia medida por el dispositivo IR}
\label{tab:fuerza-vel}
\end{table}

Como es de esperar el modelo cúbico aproxima mejor los puntos que el modelo cuadrático, sin embargo cualquiera de los dos modelos ajusta adecuadamente los puntos. Esto fue observado gráficamente en una primera instancia y se comprobó realizando el estudio del error promedio y de la desviación estándar. Ya que ambos modelos parecen adecuados a partir de este momento se trabajará con el más sencillo de los dos, es decir con el modelo cuadrático. Por lo tanto:

$$
T=3.5296\times10^{-5}\omega-4.9293\times10^{-4}
$$


\begin{figure}[H]
  \vspace{-20pt}
  \begin{center}
    \includegraphics[width=0.8\textwidth]{./Pics/fvel.jpg}
  \end{center}
  \vspace{-20pt}
  \caption{Curva experimental de Fuerza-Velocidad angular}
  \label{fig:fvel}
  \vspace{-10pt}
\end{figure}

\subsection{Obtención de la curva $i^2c$ contra velocidad angular}

En la tabla \ref{tab:iw} se presentan los resultados obtenidos de frecuencia para distintos valores del comando I2C.
\begin{table}[H]
\centering
\begin{tabular}{|c|c|c|} 
	\hline
	\cellcolor[gray]{0.8} \textbf{Comando $i^2c$} & 
	\cellcolor[gray]{0.8} \textbf{Velocidad angular (rpm)} &
	\cellcolor[gray]{0.8} \textbf{Velocidad angular (rad/s)} \\ \hline \hline
0 & 0 & 0\\ \hline 
50 & 17.29 & 108.6206 \\ \hline 
70 & 24.51 & 154.0166 \\ \hline 
90 & 31.65 & 198.8628 \\ \hline 
110 & 37.50 & 235.6194 \\ \hline 
130 & 43.06 & 270.5697 \\ \hline 
150 & 47.91 & 301.0431 \\ \hline 
170 & 52.58 & 330.3385 \\ \hline 
200 & 58.26 & 366.0741 \\ \hline 
250 & 66.45 & 417.5177 \\ \hline 
\end{tabular}
\caption{Comando $i^2c$ enviado y velocidad angular obtenida}
\label{tab:iw}
\end{table}

En la figura \ref{fig:iwi} se muestran gráficamente los resultados obtenidos de ajustar un modelo cuadrático a la curva \emph{comando $i^2c$ vs. velocidad angular}.

\begin{figure} [h!]
\centering
  \subfloat[Curva $i^2c$ contra velocidad angular]{\label{fig:iw}
  		\includegraphics[width=.5\textwidth]{./Pics/iw.png}} 
  \subfloat[Curva velocidad angular contra $i^2c$]{\label{fig:wi} 
  		\includegraphics[width=.5\textwidth]{./Pics/wi.png}}
  \caption{$i^2c$ y velocidad angular}
  \label{fig:iwi}
\end{figure}

Se realiza el ajuste de dos maneras similares. En la primera, mostrada en la figura \ref{fig:iw}, se propone un modelo cuadrático y otro cúbico para la velocidad angular en función del comando $i^2c$. En la segunda, mostrada en la figura \ref{fig:wi}, se proponen los modelos cuadrático y cíºbico para el comando $i^2c$ en función de la velocidad angular.

\subsubsection*{Ajuste 1}
Se ajusta la velocidad angular con el comando $i^2c$ de forma que la velocidad angular siga un modelo cuadrático frente al comando $i^2c$.\\

Los resultados obtenidos son, para el modelo cuadrático:
\begin{itemize}
\item Modelo: $w=-3.380\times 10^{-3}x^2+2.531x-3.493$
\item Desviación estándar: $\sigma = 2.854$
\end{itemize}
Los resultados para el modelo cúbico son:
\begin{itemize}
\item Modelo: $w=-3.521\times 10^{-6}x^3-2.064\times 10^{-3}x^2+2.407x-1.602$
\item Desviación estándar: $\sigma = 2.452$
\end{itemize}

No resulta claro su alguno de los modelos es el indicado. Se obtienen desviaciones no muy chicas. Hay que probar con otro modelo.

\subsubsection*{Ajuste 2}
Se ajusta la velocidad angular con el comando $i^2c$ de forma que el comando $i^2c$ siga un modelo cuadrático frente a la velocidad angular.\\

Los resultados obtenidos son, para el modelo cuadrático:
\begin{itemize}
\item Modelo: $x=6737\times 10^{-4}w^2+2.924\times 10^{-1}w+4.351$
\item Desviación estándar: $\sigma = 4.171$
\end{itemize}
Los resultados para el modelo cúbico son:
\begin{itemize}
\item Modelo: $x=2.211\times 10^{-6}w^3-7.115\times 10^{-4}w^2+5.104\times 10^{-1}w+1.999\times 10^{-2}$
\item Desviación estándar: $\sigma = 4.013\times 10^{-1}$
\end{itemize}

En este caso se puede ver que la desviación estándar obtenida con el modelo cúbico es 1 orden menor que la obtenida con el modelo cuadrático. Además al observar la figura \ref{fig:wi} se divisa claramente que la curva del modelo cúbico se ajusta mejor a los datos obtenidos experimentalmente. Se concluye entonces que las magnitudes en cuestión se relacionan de la siguiente forma:
$$x=2.211\times 10^{-6}w^3-7.115\times 10^{-4}w^2+5.104\times 10^{-1}w+1.999\times 10^{-2}$$

\subsection{Obtención de la curva $i^2c$ contra fuerza}

Se enviaron distintos comandos de $i^2c$ y utilizando una balanza electrónica de 5g de apreciación se procedió a medir la fuerza que realizan los 4 motores juntos. Luego, avalados por las conclusiones de la sección \ref{sec:motores}, se obtiene la fuerza de cada motor, simplemente dividiendo la fuerza total entre 4. Los datos se presentan en la tabla \ref{tab:if}.

\begin{table}[H]
\centering
\begin{tabular}{|c|c|} 
	\hline
	\cellcolor[gray]{0.8} \textbf{Comando $i^2c$} & 
	\cellcolor[gray]{0.8} \textbf{Fuerza (N)} \\ \hline \hline
	  0 &      0 \\ \hline
	 50 &0.34335 \\ \hline
	 70 &0.73575 \\ \hline
	 90 & 1.2263 \\ \hline
	110 & 1.8762 \\ \hline
	130 &  2.477 \\ \hline
	150 & 3.0656 \\ \hline
	170 & 3.7278 \\ \hline
	200 & 4.5862 \\ \hline
	250 &  5.886 \\ \hline
\end{tabular}
\caption{Comando $i^2c$ enviado y fuerza obtenida}
\label{tab:if}
\end{table}

Se desea ajustar la fuerza que realizan los motores con modelos lineal, cuadrático y cúbico, en función del comando $i^2c$. Los resultados se presentan en la figura \ref{fig:if}.

\begin{figure}[h!]
  \begin{center}
	\includegraphics[width=0.7\textwidth]{./Pics/if.png}
  \end{center}
  \caption{Curva $i^2c$ contra fuerza}
  \label{fig:if}
\end{figure}

\begin{itemize}
\item Modelo Lineal
	\begin{itemize}
	\item Modelo: $F=2.565\times 10^{-2}x-7.363\times 10^{-1}$
	\item Desviación estándar: $1.520$
	\end{itemize}
\item Modelo Cuadrático
	\begin{itemize}
	\item Modelo: $F=4.211\times 10^{-5}x^2+1.508\times 10^{-2}x-2.830\times 10^{-1}$
	\item Desviación estándar: $2.087\times 10^{-1}$
	\end{itemize}
\item Modelo Cúbico
	\begin{itemize}
	\item Modelo: $F=-4.955\times 10^{-7}x^3+2.274\times 10^{-4}x^2-2.352\times 10^{-3}x- 1.689\times 10^{-2}$
	\item Desviación estándar: $3.667\times 10^{-2}$
	\end{itemize}		
\end{itemize}

TODO: Decidirse por una. Parece q es la cúbica no?


\subsection{Comparación entre motores}
\label{sec:motores}
Se envían diferentes comandos $i^2c$ al cuadricóptero y se mide la velocidad angular de todos los motores. Los datos obtenidos se muestran en la tabla \ref{tab:motores}.

\begin{table}[H]
\centering
\begin{tabular}{|c|c|c|c|c|c|} 
	\cline{3-6} \multicolumn{1}{c}{} & \multicolumn{1}{c}{} & 
	\multicolumn{4}{|c|}{\cellcolor[gray]{0.6}Velocidad angular (rad/s)} \\ \hline
	\cellcolor[gray]{0.8} {$\mathbf{i^2c}$} & 
	\cellcolor[gray]{0.8} \textbf{Fuerza (N)} &
	\cellcolor[gray]{0.8} \textbf{Motor D0} &
	\cellcolor[gray]{0.8} \textbf{Motor D2} &
	\cellcolor[gray]{0.8} \textbf{Motor D4} &
	\cellcolor[gray]{0.8} \textbf{Motor D6}   \\ \hline \hline
	  0 &      0 &    0 &    0 &    0 &    0 \\ \hline
	 50 &0.34335 & 34.2 & 34.3 & 35.5 & 34.3 \\ \hline
	 70 &0.73575 & 49.2 & 49.5 &   49 & 48.4 \\ \hline
	 90 & 1.2263 & 63.7 & 62.7 & 63.3 & 63.5 \\ \hline
	110 & 1.8762 & 76.7 & 74.4 & 75.5 & 73.4 \\ \hline
	130 &  2.477 & 87.3 & 86.3 & 86.2 & 84.7 \\ \hline
	150 & 3.0656 & 97.5 & 95.4 & 96.2 & 94.2 \\ \hline
	170 & 3.7278 &104.7 &104.2 &106.2 &105.5 \\ \hline
	200 & 4.5862 &115.5 &113.4 &119.9 &117.3 \\ \hline
	250 &  5.886 &133.5 &132.4 &131.5 &134.2 \\ \hline
\end{tabular}
\caption{Comando $i^2c$ enviado y fuerza obtenida}
\label{tab:motores}
\end{table}

El análisis gráfico se presenta en la figura \ref{fig:motores}.

\begin{figure}[h!]
  \begin{center}
	\includegraphics[width=0.7\textwidth]{./Pics/motores.png}
  \end{center}
  \caption{Comparación de la curva $i^2c$ vs. velocidad angular para los 4 motores}
  \label{fig:motores}
\end{figure}

Puede verse claramente que el comportamiento de los motores es en todos los casos similar.\\

TODO: Poner alguna medida del error entre motores. de las diferencias entre motores más bien.

Se puede decir entonces que:
\begin{itemize}
\item La fuerza medida (de los 4 motores juntos) corresponde con el cuádruple de la fuerza ejercida por cada uno de ellos
\item Es válido promediar las velocidades angulares de los 4 motores y trabajar con esos promedios como un motor tí­pico. Además de este modo se reducen los posibles errores que se pueden haber causado a la hora de realizar las medidas.
\end{itemize}

\end{document}
